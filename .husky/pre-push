#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "üîç Running pre-push checks..."
echo ""

# Run lint
echo "‚Üí Running lint..."
pnpm lint
LINT_EXIT=$?

# Run typecheck
echo ""
echo "‚Üí Running typecheck..."
pnpm typecheck
TYPECHECK_EXIT=$?

echo ""

# Check if there were any errors
if [ $LINT_EXIT -ne 0 ] || [ $TYPECHECK_EXIT -ne 0 ]; then
    echo "‚ö†Ô∏è  Some checks failed!"
    echo ""
    echo "You can:"
    echo "  1. Fix the issues and try again"
    echo "  2. Push anyway with: git push --no-verify"
    echo ""

    # Ask user what to do (only in interactive mode)
    if [ -t 1 ]; then
        read -p "Push anyway? (y/N) " -n 1 -r
        echo
        if [[ ! $REPLY =~ ^[Yy]$ ]]; then
            echo "‚ùå Push cancelled. Fix issues or use --no-verify"
            exit 1
        fi
        echo "‚úÖ Pushing despite warnings..."
    else
        # Non-interactive mode (CI): fail
        exit 1
    fi
fi

echo "‚úÖ All checks passed!"
exit 0
