================================================================================
CONTEXT
================================================================================

You are implementing three new UI components for the Fidus Memory prototype -
a chat-based interface for teaching the AI about user preferences with
situational context awareness.

--------------------------------------------------------------------------------
PROJECT BACKGROUND
--------------------------------------------------------------------------------

Fidus is a privacy-first AI personal assistant built with:
- Domain-Driven Design (DDD) - Clear bounded contexts
- Multi-Agent Architecture - LangGraph-based supervisors
- AI-Driven UI Paradigm - LLM decides UI form dynamically (NOT traditional
  fixed screens)
- Monorepo Structure - pnpm workspace with packages/api, packages/web,
  packages/ui

Fidus Memory Prototype enables users to:
1. Chat naturally about their preferences ("I always drink cappuccino in the
   morning")
2. System learns preferences with situational context (time, location,
   activity)
3. View learned preferences grouped by domain with confidence scores
4. Reinforce/weaken preferences through acceptance/rejection

--------------------------------------------------------------------------------
TECHNICAL STACK
--------------------------------------------------------------------------------

Frontend:
- Framework: Next.js 14 (App Router)
- Language: TypeScript (strict mode, NO any types)
- Styling: CSS Modules + CSS Variables (NO Tailwind in components)
- Component Library: @fidus/ui (React components with design system)
- Testing: Vitest + React Testing Library

Design System (@fidus/ui):
- 41 existing components (Button, Badge, Card, TextInput, Avatar, Chip,
  Tooltip, ProgressBar, etc.)
- CSS Variables: --spacing-*, --color-*, --radius-*, --font-*
- NO hardcoded spacing - Always use CSS variables
- Component Structure: Each component has .tsx + .css + .test.tsx

--------------------------------------------------------------------------------
ARCHITECTURE DECISIONS
--------------------------------------------------------------------------------

CRITICAL: Read AI-Driven UI Paradigm First!
- UI is context-adaptive, NOT predetermined
- LLM decides UI form (chat vs form vs widget) at runtime
- NO fixed screens (Dashboard Screen, Calendar Screen) - WRONG
- Dashboard is Opportunity Surface with dynamic cards
- User controls dismissal (swipe/X) - NO auto-hide timers - WRONG

Reference Documents:
- docs/ux-ui-design/00-ai-driven-ui-paradigm.md - THE FOUNDATION
- docs/prototypes/fidus-memory/ui-components.md - Component specifications
- docs/ux-ui-design/04-interaction-patterns.md - 4 core patterns
- docs/ux-ui-design/05-design-system-components.md - Component guidelines

================================================================================
SYSTEM PROMPT
================================================================================

You are an expert React Component Developer specializing in:
- TypeScript - Strict typing, proper generics, NO any types
- React Best Practices - Functional components, hooks, performance
  optimization
- Accessibility (a11y) - WCAG AA compliance, semantic HTML, ARIA labels
- CSS Architecture - CSS Modules, BEM naming, CSS variables, responsive design
- Testing - Unit tests with Vitest + React Testing Library (>80% coverage)
- Component API Design - Intuitive props, good defaults, composability

--------------------------------------------------------------------------------
CORE PRINCIPLES
--------------------------------------------------------------------------------

1. Type Safety
   - NO any types - Use proper types or unknown
   - NO type casting with as - Use type guards or predicates
   - Define shared interfaces in proper location
   - Use Zod schemas for runtime validation when needed

2. CSS Guidelines
   - ALWAYS use CSS variables from design system
   - NEVER hardcode spacing as px values
   - Use design tokens: var(--spacing-md), var(--color-primary)
   - Follow BEM naming: .component__element--modifier
   - Mobile-first responsive design

3. Component Structure
   packages/ui/src/components/component-name/
   â”œâ”€â”€ component-name.tsx      # Component logic
   â”œâ”€â”€ component-name.css      # Component styles
   â”œâ”€â”€ component-name.test.tsx # Component tests
   â””â”€â”€ index.ts                # Public exports

4. Accessibility
   - Use semantic HTML (<button>, <input>, not <div onClick>)
   - Add ARIA labels where needed
   - Ensure keyboard navigation works
   - Test with screen readers
   - Color contrast WCAG AA compliant

5. Testing
   - Unit tests for each component (>80% coverage)
   - Test user interactions (click, type, keyboard)
   - Test accessibility (aria-labels, roles)
   - Test edge cases (empty states, loading states)
   - Use data-test-id for test selectors (single value, no spaces)

6. Documentation
   - JSDoc comments for all public interfaces
   - Usage examples in component README
   - Storybook stories (if applicable)

================================================================================
USER PROMPT
================================================================================

--------------------------------------------------------------------------------
TASK OVERVIEW
--------------------------------------------------------------------------------

Implement 3 new components for the Fidus Memory chat interface:

1. MessageBubble - Individual chat message display (user vs AI)
2. ChatInterface - Complete chat layout with message list + input
3. ConfidenceIndicator - Visual confidence score display

These components will be added to the @fidus/ui package and reused across
Fidus applications.

================================================================================
COMPONENT 1: MESSAGE BUBBLE
================================================================================

--------------------------------------------------------------------------------
REQUIREMENTS
--------------------------------------------------------------------------------

Display a single chat message with:
- Role-based alignment: User (right), AI (left)
- Avatar: User vs bot icon
- Content: Message text (markdown support optional for v1)
- Timestamp: Relative time ("Just now", "2m ago", "5h ago")
- Suggestions: Optional suggestion chips (for AI messages with learned
  preferences)

--------------------------------------------------------------------------------
COMPONENT API
--------------------------------------------------------------------------------

export interface Suggestion {
  id: string;
  text: string;
  confidence: number;
  onAccept?: () => void;
  onReject?: () => void;
}

export interface Message {
  id: string;
  role: 'user' | 'assistant';
  content: string;
  timestamp: Date;
  suggestions?: Suggestion[];
  avatar?: {
    src?: string;
    fallback: string;
  };
}

export interface MessageBubbleProps extends Message {}

export function MessageBubble(props: MessageBubbleProps): JSX.Element;

--------------------------------------------------------------------------------
VISUAL DESIGN
--------------------------------------------------------------------------------

User Message (Right-aligned):
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚ "I always have          â”‚
                         â”‚ cappuccino in           â”‚ ðŸ‘¤
                         â”‚ the morning"            â”‚
                         â”‚ 2m ago              â”€â”€â”€â”€â”˜
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

AI Message (Left-aligned with suggestions):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ðŸ¤–  "Noted! Cappuccino in the       â”‚
â”‚     morning seems to be             â”‚
â”‚     important to you."              â”‚
â”‚     Just now                        â”‚
â”‚                                     â”‚
â”‚  [cappuccino (80%)] [âœ“] [âœ—]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

--------------------------------------------------------------------------------
IMPLEMENTATION CHECKLIST
--------------------------------------------------------------------------------

[ ] Create packages/ui/src/components/message-bubble/message-bubble.tsx
[ ] Create packages/ui/src/components/message-bubble/message-bubble.css
[ ] Create packages/ui/src/components/message-bubble/message-bubble.test.tsx
[ ] Create packages/ui/src/components/message-bubble/index.ts
[ ] Implement formatRelativeTime() utility function
[ ] Reuse existing Avatar component
[ ] Reuse existing Chip component for suggestions
[ ] Add BEM CSS classes (.message-bubble, .message-bubble--user,
    .message-bubble--assistant)
[ ] Use CSS variables for all spacing, colors, borders
[ ] Write unit tests (>80% coverage):
    - Render user message right-aligned
    - Render AI message left-aligned with avatar
    - Render suggestions as chips
    - Format relative time correctly
    - Handle click on suggestion accept/reject
[ ] Add JSDoc comments
[ ] Export from packages/ui/src/index.ts

--------------------------------------------------------------------------------
CSS VARIABLE USAGE
--------------------------------------------------------------------------------

CORRECT:
.message-bubble {
  gap: var(--spacing-sm);           /* âœ“ Use variable */
  max-width: 70%;                   /* âœ“ Percentage OK */
}

.message-bubble__text {
  padding: var(--spacing-md);       /* âœ“ Use variable */
  border-radius: var(--radius-lg);  /* âœ“ Use variable */
}

.message-bubble--user .message-bubble__text {
  background-color: var(--color-primary);     /* âœ“ Use variable */
  color: var(--color-background);             /* âœ“ Use variable */
}

WRONG:
.message-bubble__text {
  padding: 16px;              /* âœ— NO hardcoded values */
  border-radius: 12px;        /* âœ— NO hardcoded values */
}

================================================================================
COMPONENT 2: CHAT INTERFACE
================================================================================

--------------------------------------------------------------------------------
REQUIREMENTS
--------------------------------------------------------------------------------

Complete chat layout with:
- Scrollable message list - Auto-scroll to bottom on new message
- Message input - Multi-line with Shift+Enter for newline, Enter to send
- Send button - Disabled while sending or when input empty
- Loading indicator - Show "Thinking..." during AI response
- Empty state - "Start chatting to teach Fidus Memory..."

--------------------------------------------------------------------------------
COMPONENT API
--------------------------------------------------------------------------------

export interface ChatInterfaceProps {
  messages: Message[];
  onSendMessage: (content: string) => void | Promise<void>;
  isLoading?: boolean;
  placeholder?: string;
  maxHeight?: string;
  emptyStateTitle?: string;
  emptyStateMessage?: string;
}

export function ChatInterface(props: ChatInterfaceProps): JSX.Element;

--------------------------------------------------------------------------------
VISUAL LAYOUT
--------------------------------------------------------------------------------

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Message List (Scrollable)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ [MessageBubble: User]                â”‚ â”‚
â”‚  â”‚ [MessageBubble: AI]                  â”‚ â”‚
â”‚  â”‚ [MessageBubble: User]                â”‚ â”‚
â”‚  â”‚ [Loading: "Thinking..."]             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Input Area                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ [TextArea: "Type a message..."] â”‚    â”‚
â”‚  â”‚ (Shift+Enter: newline)          â”‚    â”‚
â”‚  â”‚ (Enter: send)                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  [Send Button]                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

--------------------------------------------------------------------------------
IMPLEMENTATION CHECKLIST
--------------------------------------------------------------------------------

[ ] Create packages/ui/src/components/chat-interface/chat-interface.tsx
[ ] Create packages/ui/src/components/chat-interface/chat-interface.css
[ ] Create packages/ui/src/components/chat-interface/chat-interface.test.tsx
[ ] Create packages/ui/src/components/chat-interface/index.ts
[ ] Implement auto-scroll on new message (useEffect + ref)
[ ] Handle Enter vs Shift+Enter (keyboard event handler)
[ ] Clear input after send
[ ] Focus input after send (UX improvement)
[ ] Reuse existing TextArea component
[ ] Reuse existing Button component
[ ] Reuse existing Spinner component for loading
[ ] Reuse existing EmptyCard for empty state
[ ] Use MessageBubble component for messages
[ ] Add BEM CSS classes
[ ] Use CSS variables for all styling
[ ] Write unit tests (>80% coverage):
    - Render empty state when no messages
    - Send message on Enter key
    - Not send on Shift+Enter (newline)
    - Not send empty messages
    - Disable input while loading
    - Auto-scroll on new message
    - Clear input after send
[ ] Add JSDoc comments
[ ] Export from packages/ui/src/index.ts

--------------------------------------------------------------------------------
BEHAVIOR REQUIREMENTS
--------------------------------------------------------------------------------

Keyboard Handling:
- Enter â†’ Send message (prevent default to avoid newline)
- Shift + Enter â†’ Add newline (default textarea behavior)
- Focus input after sending message

State Management:
- Disable input and send button while isLoading=true
- Disable send button when input is empty or whitespace-only
- Clear input after successful send
- Preserve scroll position when possible, but scroll to bottom on new message

================================================================================
COMPONENT 3: CONFIDENCE INDICATOR
================================================================================

--------------------------------------------------------------------------------
REQUIREMENTS
--------------------------------------------------------------------------------

Visualize preference confidence score with:
- Percentage display - 0-100%
- Color-coded by level:
  - 0-30% (Uncertain): Gray/Yellow
  - 30-50% (Learning): Blue
  - 50-80% (Confident): Green
  - 80-100% (Very Confident): Dark Green
- Progress bar - Visual representation
- Tooltip - Explanation on hover
- Variants: minimal (badge only), detailed (bar + badge)

--------------------------------------------------------------------------------
COMPONENT API
--------------------------------------------------------------------------------

export interface ConfidenceIndicatorProps {
  confidence: number; // 0.0 - 1.0
  variant?: 'minimal' | 'detailed';
  showTooltip?: boolean;
  size?: 'sm' | 'md' | 'lg';
}

export function ConfidenceIndicator(props: ConfidenceIndicatorProps):
JSX.Element;

--------------------------------------------------------------------------------
VISUAL DESIGN
--------------------------------------------------------------------------------

Minimal Variant:
[80%] â† Badge only (green color)

Detailed Variant:
Confidence            [80%]
[â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”€â”€â”€â”€â”€â”€â”€â”€] Very Confident

--------------------------------------------------------------------------------
CONFIDENCE LEVEL MAPPING
--------------------------------------------------------------------------------

Confidence Range | Level          | Badge Variant | Tooltip Message
0.8 - 1.0       | Very Confident | success       | "Very Confident - AI will
auto-fill this preference"
0.5 - 0.8       | Confident      | info          | "Confident - AI will
auto-suggest this preference"
0.3 - 0.5       | Learning       | warning       | "Learning - AI is still
learning this preference"
0.0 - 0.3       | Uncertain      | default       | "Uncertain - Not enough
data to be confident"

--------------------------------------------------------------------------------
IMPLEMENTATION CHECKLIST
--------------------------------------------------------------------------------

[ ] Create packages/ui/src/components/confidence-indicator/
    confidence-indicator.tsx
[ ] Create packages/ui/src/components/confidence-indicator/
    confidence-indicator.css
[ ] Create packages/ui/src/components/confidence-indicator/
    confidence-indicator.test.tsx
[ ] Create packages/ui/src/components/confidence-indicator/index.ts
[ ] Implement getConfidenceLevel() helper (0.0-1.0 â†’ "Very Confident")
[ ] Implement getConfidenceBadgeVariant() helper (0.0-1.0 â†’
    success/info/warning/default)
[ ] Implement getTooltipMessage() helper
[ ] Reuse existing Badge component
[ ] Reuse existing ProgressBar component
[ ] Reuse existing Tooltip component
[ ] Add BEM CSS classes
[ ] Use CSS variables for all styling
[ ] Write unit tests (>80% coverage):
    - Display percentage correctly
    - Show correct confidence level
    - Render minimal variant without progress bar
    - Render detailed variant with progress bar
    - Show tooltip on hover
    - Test all confidence ranges (uncertain, learning, confident, very
      confident)
[ ] Add JSDoc comments
[ ] Export from packages/ui/src/index.ts

================================================================================
TESTING STRATEGY
================================================================================

--------------------------------------------------------------------------------
UNIT TEST REQUIREMENTS
--------------------------------------------------------------------------------

Coverage Target: >80% for each component

Test Categories:
1. Rendering - Component renders correctly with different props
2. User Interactions - Click, type, keyboard events work
3. Edge Cases - Empty states, loading states, error states
4. Accessibility - ARIA labels, keyboard navigation
5. Visual Regression - Component styling matches design (snapshot tests
   optional)

--------------------------------------------------------------------------------
EXAMPLE TEST STRUCTURE
--------------------------------------------------------------------------------

// message-bubble.test.tsx
import { render, screen } from '@testing-library/react';
import { MessageBubble, type Message } from './message-bubble';

describe('MessageBubble', () => {
  it('should render user message right-aligned', () => {
    const message: Message = {
      id: '1',
      role: 'user',
      content: 'Hello',
      timestamp: new Date(),
    };

    const { container } = render(<MessageBubble {...message} />);

    expect(container.querySelector('.message-bubble--user'))
      .toBeInTheDocument();
    expect(screen.getByText('Hello')).toBeInTheDocument();
  });

  it('should render AI message left-aligned with avatar', () => {
    const message: Message = {
      id: '2',
      role: 'assistant',
      content: 'Hi there!',
      timestamp: new Date(),
    };

    render(<MessageBubble {...message} />);

    expect(screen.getByText('Hi there!')).toBeInTheDocument();
    expect(screen.getByText('AI')).toBeInTheDocument(); // Avatar fallback
  });

  // ... more tests
});

--------------------------------------------------------------------------------
RUNNING TESTS
--------------------------------------------------------------------------------

# Navigate to UI package
cd packages/ui

# Run tests
pnpm test

# Run with coverage
pnpm test --coverage

# Watch mode (during development)
pnpm test --watch

================================================================================
INTEGRATION STEPS
================================================================================

--------------------------------------------------------------------------------
1. ADD COMPONENTS TO @fidus/ui
--------------------------------------------------------------------------------

Update packages/ui/src/index.ts:

// Existing exports
export * from './components/button/button';
export * from './components/badge/badge';
// ... other components

// NEW: Chat components
export * from './components/message-bubble/message-bubble';
export * from './components/chat-interface/chat-interface';
export * from './components/confidence-indicator/confidence-indicator';

// Re-export types
export type { Message, Suggestion } from
'./components/message-bubble/message-bubble';
export type { ChatInterfaceProps } from
'./components/chat-interface/chat-interface';
export type { ConfidenceIndicatorProps } from
'./components/confidence-indicator/confidence-indicator';

--------------------------------------------------------------------------------
2. UPDATE @fidus/ui PACKAGE VERSION
--------------------------------------------------------------------------------

Update packages/ui/package.json:

{
  "name": "@fidus/ui",
  "version": "1.1.0",  // â† Increment minor version
  "description": "Fidus UI Component Library (now with chat components)"
}

--------------------------------------------------------------------------------
3. DOCUMENT NEW COMPONENTS
--------------------------------------------------------------------------------

Update packages/ui/README.md:

## Chat Components (v1.1.0)

### MessageBubble
Display individual chat messages with role-based styling.

### ChatInterface
Complete chat layout with message list and input.

### ConfidenceIndicator
Visualize ML confidence scores with color-coded badges and progress bars.

See component files for detailed API documentation.

--------------------------------------------------------------------------------
4. BUILD AND TEST
--------------------------------------------------------------------------------

# Build @fidus/ui package
cd packages/ui
pnpm build

# Run tests
pnpm test

# Type check
pnpm typecheck

# Lint
pnpm lint

================================================================================
ACCEPTANCE CRITERIA
================================================================================

--------------------------------------------------------------------------------
FUNCTIONAL REQUIREMENTS
--------------------------------------------------------------------------------

[ ] All 3 components render correctly
[ ] MessageBubble displays user/AI messages with proper alignment
[ ] ChatInterface handles Enter vs Shift+Enter correctly
[ ] ChatInterface auto-scrolls to bottom on new message
[ ] ConfidenceIndicator shows correct color for each confidence level
[ ] Tooltips appear on hover where specified
[ ] All components reuse existing @fidus/ui components
[ ] NO hardcoded spacing values (all use CSS variables)

--------------------------------------------------------------------------------
NON-FUNCTIONAL REQUIREMENTS
--------------------------------------------------------------------------------

[ ] TypeScript strict mode (NO any types)
[ ] CSS follows BEM naming convention
[ ] All CSS uses design system variables
[ ] Unit tests achieve >80% coverage
[ ] All tests pass
[ ] No TypeScript errors
[ ] No linting errors
[ ] Components are accessible (WCAG AA)
[ ] Components work on mobile (responsive)

--------------------------------------------------------------------------------
DOCUMENTATION REQUIREMENTS
--------------------------------------------------------------------------------

[ ] JSDoc comments on all public interfaces
[ ] README updated with new components
[ ] Version bumped to v1.1.0
[ ] Changelog entry added (if exists)

================================================================================
COMMON PITFALLS TO AVOID
================================================================================

--------------------------------------------------------------------------------
TYPESCRIPT ANTI-PATTERNS
--------------------------------------------------------------------------------

WRONG:
// Using 'any'
function processMessage(data: any) {
  return data.content;
}

// Type casting
const message = response as Message;

CORRECT:
// Proper typing
function processMessage(data: Message): string {
  return data.content;
}

// Type guard
function isMessage(value: unknown): value is Message {
  return (
    typeof value === 'object' &&
    value !== null &&
    'id' in value &&
    'role' in value &&
    'content' in value
  );
}

--------------------------------------------------------------------------------
CSS ANTI-PATTERNS
--------------------------------------------------------------------------------

WRONG:
/* Hardcoded spacing */
.message-bubble {
  padding: 16px;
  margin: 8px;
  gap: 12px;
}

/* Hardcoded colors */
.message-bubble--user {
  background: #007bff;
  color: #ffffff;
}

CORRECT:
/* CSS variables */
.message-bubble {
  padding: var(--spacing-md);
  margin: var(--spacing-sm);
  gap: var(--spacing-sm);
}

/* Design tokens */
.message-bubble--user {
  background-color: var(--color-primary);
  color: var(--color-background);
}

--------------------------------------------------------------------------------
ACCESSIBILITY ANTI-PATTERNS
--------------------------------------------------------------------------------

WRONG:
// div with onClick (not keyboard accessible)
<div onClick={handleSend}>Send</div>

// No ARIA label for icon-only button
<button onClick={handleReject}>âœ—</button>

CORRECT:
// Semantic button
<button onClick={handleSend} aria-label="Send message">
  Send
</button>

// ARIA label for accessibility
<button onClick={handleReject} aria-label="Reject suggestion">
  âœ—
</button>

--------------------------------------------------------------------------------
REACT ANTI-PATTERNS
--------------------------------------------------------------------------------

WRONG:
// Not cleaning up effect
useEffect(() => {
  const interval = setInterval(() => updateTime(), 1000);
}, []);

// Mutating state directly
messages.push(newMessage);

CORRECT:
// Clean up interval
useEffect(() => {
  const interval = setInterval(() => updateTime(), 1000);
  return () => clearInterval(interval);
}, []);

// Immutable state update
setMessages((prev) => [...prev, newMessage]);

================================================================================
SUCCESS METRICS
================================================================================

Code Quality:
âœ“ 0 TypeScript errors
âœ“ 0 linting errors
âœ“ >80% test coverage
âœ“ All tests passing

Performance:
âœ“ Component render time <16ms (60fps)
âœ“ Auto-scroll smooth animation
âœ“ No layout shifts on message add

Accessibility:
âœ“ Keyboard navigation works
âœ“ Screen reader announces messages
âœ“ Color contrast meets WCAG AA
âœ“ Focus indicators visible

Integration:
âœ“ Components exported from @fidus/ui
âœ“ TypeScript types exported
âœ“ Can be imported in Fidus Memory frontend
âœ“ Works in development and production builds

================================================================================
TIMELINE
================================================================================

Estimated: 3-5 days

Day 1: MessageBubble
[ ] Implement MessageBubble component
[ ] Write CSS with design tokens
[ ] Write unit tests
[ ] Test accessibility

Day 2: ChatInterface
[ ] Implement ChatInterface component
[ ] Implement auto-scroll behavior
[ ] Implement keyboard handling
[ ] Write unit tests

Day 3: ConfidenceIndicator
[ ] Implement ConfidenceIndicator component
[ ] Implement helper functions
[ ] Write unit tests
[ ] Integration testing

Day 4: Polish & Integration
[ ] Fix any bugs
[ ] Improve accessibility
[ ] Update documentation
[ ] Test in Fidus Memory frontend

Day 5: Review & Ship
[ ] Code review
[ ] Final testing
[ ] Update version to v1.1.0
[ ] Commit and push

================================================================================
ADDITIONAL RESOURCES
================================================================================

--------------------------------------------------------------------------------
DESIGN SYSTEM VARIABLES
--------------------------------------------------------------------------------

Spacing:
--spacing-xs: 4px
--spacing-sm: 8px
--spacing-md: 16px
--spacing-lg: 24px
--spacing-xl: 32px

Colors:
--color-primary: Primary brand color
--color-secondary: Secondary brand color
--color-background: Background color
--color-foreground: Text color
--color-surface: Card/surface background
--color-border: Border color
--color-text-secondary: Muted text

Border Radius:
--radius-sm: 4px
--radius-md: 8px
--radius-lg: 12px
--radius-xl: 16px

--------------------------------------------------------------------------------
EXISTING COMPONENTS TO REUSE
--------------------------------------------------------------------------------

- Avatar - User/bot avatar icons
- Badge - Confidence score badges
- Button - Send button
- Chip - Suggestion chips
- EmptyCard - Empty state
- ProgressBar - Confidence progress bar
- Spinner - Loading indicator
- TextArea - Multi-line input (if exists, otherwise use textarea)
- Tooltip - Confidence explanations

--------------------------------------------------------------------------------
EXAMPLE COMPONENT STRUCTURE
--------------------------------------------------------------------------------

Reference how existing components are structured:
packages/ui/src/components/button/
â”œâ”€â”€ button.tsx       # Component logic + JSDoc
â”œâ”€â”€ button.css       # Styles with CSS variables
â”œâ”€â”€ button.test.tsx  # Unit tests
â””â”€â”€ index.ts         # export { Button } from './button';

================================================================================
QUESTIONS TO ANSWER BEFORE STARTING
================================================================================

1. âœ“ Have you read the AI-Driven UI Paradigm document?
2. âœ“ Do you understand the design system (CSS variables)?
3. âœ“ Have you reviewed existing @fidus/ui components?
4. âœ“ Do you know how to run tests in the monorepo?
5. âœ“ Are you familiar with React Testing Library?

If you answered "No" to any question, review the documentation first!

================================================================================
GETTING HELP
================================================================================

Architecture Questions:
- Read: docs/architecture/README.md
- Read: docs/domain-model/README.md

UI/UX Questions:
- Read: docs/ux-ui-design/00-ai-driven-ui-paradigm.md
- Read: docs/ux-ui-design/04-interaction-patterns.md

Component Specs:
- Read: docs/prototypes/fidus-memory/ui-components.md

Fidus Memory Implementation:
- Read: docs/prototypes/fidus-memory/implementation-plan.md

Monorepo Setup:
- Read: CLAUDE.md - Using Fidus with Claude Code

================================================================================
END OF PROMPT
================================================================================

Good luck with the implementation!
